<!DOCTYPE html>

<html lang="en">
<head>
    
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>命令行应用（Command Line Applications） &mdash; Phalcon7 1.3.2 文档</title>
    <meta name="keywords" content="php, phalcon, phalcon7, phalcon php, php framework, faster php framework">
    <link rel="stylesheet" type="text/css" href="../static/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../static/phalcon.css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.3.2',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>

    <script src="../static/jquery.min.js"></script>
    <link rel="shortcut icon" href="../static/img/favicon.ico"/>
    <link rel="index" title="索引" href="../index.html" />
    <link rel="search" title="搜索" href="../search.html" />
    <link rel="top" title="Phalcon7 1.3.2 文档" href="../index.html" />
    <link rel="next" title="命令行设置文字颜色（Command Line Text Color）" href="cli-color.html" />
    <link rel="prev" title="注解解析器（Annotations Parser）" href="annotations.html" /> 
</head>
<body>

<header class="page-header">
<nav class="navbar" role="navigation">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-menu-container">
				<span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
			</button>
			<a class="navbar-brand phalcon-logo" href="/"><span itemprop="name" class="sr-only">Phalcon PHP</span></a>
		</div>

		<div class="collapse navbar-collapse navbar-right" id="main-menu-container">
			<ul class="nav navbar-nav main-menu">
			  <li class="first"><a href="https://github.com/dreamsxin/cphalcon7" class="header-nav-link">GitHub</a></li>
			  <li class="first"><a href="https://github.com/dreamsxin/cphalcon7/releases" class="header-nav-link">Download</a></li>
			  <li class="first"><a href="/api/" class="header-nav-link">API</a></li>
			  <li class="first"><a href="/internals/" class="header-nav-link">内核开发手册</a></li>
			</ul>
		</div>
	</div>
</nav>
</header>

<div class="heading">
    <div class="container">
        <div class="row">
            <h2>Documentation</h2>
        </div>
    </div>
</div>


<div class="container-fluid">
    <div class="related">
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="cli-color.html" title="命令行设置文字颜色（Command Line Text Color）"
             accesskey="N">下一页</a> |</li>
        <li class="right" >
          <a href="annotations.html" title="注解解析器（Annotations Parser）"
             accesskey="P">上一页</a> |</li>
        <li><a href="http://myleftstudio.com">Home</a> &raquo;</li>
        <li><a href="../index.html">Phalcon7 1.3.2 文档</a> &raquo;</li> 
      </ul>
    </div>  
</div>

<div class="container-fluid">
	<div class="col-md-3 primary-box">
		<div class="panel panel-default">
			<div class="panel-heading"><a href="../index.html">內容目录</a></div>
			<div class="panel-body"><ul>
<li><a class="reference internal" href="#">命令行应用（Command Line Applications）</a><ul>
<li><a class="reference internal" href="#structure">结构（Structure）</a></li>
<li><a class="reference internal" href="#creating-a-bootstrap">创建引导（Creating a Bootstrap）</a><ul>
<li><a class="reference internal" href="#id1">从命令行参数列表中获取选项</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cli-options">使用命令行选项类（Cli Options）</a></li>
<li><a class="reference internal" href="#tasks">任务（Tasks）</a></li>
<li><a class="reference internal" href="#processing-action-parameters">处理动作参数（Processing action parameters）</a></li>
<li><a class="reference internal" href="#running-tasks-in-a-chain">链中运行任务（Running tasks in a chain）</a></li>
<li><a class="reference internal" href="#mvc-running-mvc-application">运行 MVC 应用（Running MVC Application）</a></li>
</ul>
</li>
</ul>
</div>
			<div class="panel-heading">上一个主题</div>
            <div class="panel-body"><p class="topless"><a href="annotations.html" title="上一章">&lt; 注解解析器（Annotations Parser）</a></p></div>
			<div class="panel-heading">下一个主题</div>
            <div class="panel-body"><p class="topless"><a href="cli-color.html" title="下一章">命令行设置文字颜色（Command Line Text Color） &gt;</a></p></div>
		</div>
	</div>
  <div class="col-md-9 second-box" valign="top">
	<div class="document">
		<div class="documentwrapper">
		  <div class="bodywrapper">
			<div class="body" >
			  
  <div class="section" id="command-line-applications">
<h1>命令行应用（Command Line Applications）<a class="headerlink" href="#command-line-applications" title="永久链接至标题">¶</a></h1>
<p>CLI 应用即是运行在命令行窗体上的应用。主要用来实现后台任务，命令行工具等。</p>
<div class="section" id="structure">
<h2>结构（Structure）<a class="headerlink" href="#structure" title="永久链接至标题">¶</a></h2>
<p>最小结构的 CLI 程序如下：</p>
<ul class="simple">
<li>app/config/config.php</li>
<li>app/tasks/MainTask.php</li>
<li>app/cli.php &lt;&#8211; 主要启动文件</li>
</ul>
</div>
<div class="section" id="creating-a-bootstrap">
<h2>创建引导（Creating a Bootstrap）<a class="headerlink" href="#creating-a-bootstrap" title="永久链接至标题">¶</a></h2>
<p>普通的MVC程序中，启动文件用来启动整个应用。和web应用不同, 此处应用中我们使用`cli.php`来作为启动文件。</p>
<p>下面是一个简单的启动文件示例：</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="c1">// 使用CLI工厂类作为默认的服务容器</span>
<span class="nv">$di</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Phalcon\Di\FactoryDefault\Cli</span><span class="p">();</span>

<span class="c1">// 定义应用目录路径</span>
<span class="nb">defined</span><span class="p">(</span><span class="s1">&#39;APPLICATION_PATH&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;APPLICATION_PATH&#39;</span><span class="p">,</span> <span class="nb">realpath</span><span class="p">(</span><span class="nb">dirname</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">)));</span>

<span class="sd">/**</span>
<span class="sd"> * 注册类自动加载器</span>
<span class="sd"> */</span>
<span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Loader</span><span class="p">();</span>
<span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">registerDirs</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="nx">APPLICATION_PATH</span> <span class="o">.</span> <span class="s1">&#39;/tasks&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
<span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">();</span>

<span class="c1">// 加载配置文件（如果存在）</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">is_readable</span><span class="p">(</span><span class="nx">APPLICATION_PATH</span> <span class="o">.</span> <span class="s1">&#39;/config/config.php&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$config</span> <span class="o">=</span>  <span class="nx">Phalcon\Config\Adapter\Php</span><span class="p">(</span><span class="nx">APPLICATION_PATH</span> <span class="o">.</span> <span class="s1">&#39;/config/config.php&#39;</span><span class="p">,</span> <span class="k">TRUE</span><span class="p">);</span>
    <span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;config&#39;</span><span class="p">,</span> <span class="nv">$config</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 创建console应用</span>
<span class="nv">$console</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Phalcon\Cli\Console</span><span class="p">();</span>
<span class="nv">$console</span><span class="o">-&gt;</span><span class="na">setDI</span><span class="p">(</span><span class="nv">$di</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="nv">$console</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">();</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">\Phalcon\Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
    <span class="k">exit</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>上面的代码可以使用如下方式执行：</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ php app/cli.php --task<span class="o">=</span>main --action<span class="o">=</span>main --params<span class="o">=</span><span class="m">1</span> --params<span class="o">=</span><span class="m">2</span>

这样程序就会执行任务main以及动作main，并传递参数 <span class="sb">`</span>array<span class="o">(</span><span class="m">1</span>, <span class="m">2</span><span class="o">)</span><span class="sb">`</span>
</pre></div>
</div>
<p>通过 <cite>argv</cite> 解析应用参数：</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Phalcon\Di\FactoryDefault\Cli</span> <span class="k">as</span> <span class="nx">CliDI</span><span class="p">,</span>
    <span class="nx">Phalcon\Cli\Console</span> <span class="k">as</span> <span class="nx">ConsoleApp</span><span class="p">;</span>

<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;VERSION&#39;</span><span class="p">,</span> <span class="s1">&#39;1.0.0&#39;</span><span class="p">);</span>

<span class="c1">// 使用CLI工厂类作为默认的服务容器</span>
<span class="nv">$di</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">CliDI</span><span class="p">();</span>

<span class="c1">// 定义应用目录路径</span>
<span class="nb">defined</span><span class="p">(</span><span class="s1">&#39;APPLICATION_PATH&#39;</span><span class="p">)</span>
<span class="o">||</span> <span class="nb">define</span><span class="p">(</span><span class="s1">&#39;APPLICATION_PATH&#39;</span><span class="p">,</span> <span class="nb">realpath</span><span class="p">(</span><span class="nb">dirname</span><span class="p">(</span><span class="no">__FILE__</span><span class="p">)));</span>

<span class="sd">/**</span>
<span class="sd"> * 注册类自动加载器</span>
<span class="sd"> */</span>
<span class="nv">$loader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Loader</span><span class="p">();</span>
<span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">registerDirs</span><span class="p">(</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="nx">APPLICATION_PATH</span> <span class="o">.</span> <span class="s1">&#39;/tasks&#39;</span>
    <span class="p">)</span>
<span class="p">);</span>
<span class="nv">$loader</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">();</span>

<span class="c1">// 加载配置文件（如果存在）</span>
<span class="k">if</span> <span class="p">(</span><span class="nb">is_readable</span><span class="p">(</span><span class="nx">APPLICATION_PATH</span> <span class="o">.</span> <span class="s1">&#39;/config/config.php&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$config</span> <span class="o">=</span> <span class="k">include</span> <span class="nx">APPLICATION_PATH</span> <span class="o">.</span> <span class="s1">&#39;/config/config.php&#39;</span><span class="p">;</span>
    <span class="nv">$di</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;config&#39;</span><span class="p">,</span> <span class="nv">$config</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// 创建console应用</span>
<span class="nv">$console</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ConsoleApp</span><span class="p">();</span>
<span class="nv">$console</span><span class="o">-&gt;</span><span class="na">setDI</span><span class="p">(</span><span class="nv">$di</span><span class="p">);</span>

<span class="sd">/**</span>
<span class="sd"> * 处理console应用参数</span>
<span class="sd"> */</span>
<span class="nv">$arguments</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="k">foreach</span> <span class="p">(</span><span class="nv">$argv</span> <span class="k">as</span> <span class="nv">$k</span> <span class="o">=&gt;</span> <span class="nv">$arg</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nv">$k</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$arguments</span><span class="p">[</span><span class="s1">&#39;task&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$arg</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$k</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$arguments</span><span class="p">[</span><span class="s1">&#39;action&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nv">$arg</span><span class="p">;</span>
    <span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$k</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
        <span class="nv">$arguments</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][]</span> <span class="o">=</span> <span class="nv">$arg</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// 定义全局的参数， 设定当前任务及动作</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;CURRENT_TASK&#39;</span><span class="p">,</span>   <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">:</span> <span class="k">null</span><span class="p">));</span>
<span class="nb">define</span><span class="p">(</span><span class="s1">&#39;CURRENT_ACTION&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nb">isset</span><span class="p">(</span><span class="nv">$argv</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">?</span> <span class="nv">$argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">:</span> <span class="k">null</span><span class="p">));</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="c1">// 处理参数</span>
    <span class="nv">$console</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">(</span><span class="nv">$arguments</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">\Phalcon\Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
    <span class="k">exit</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>上面的代码可以使用如下方式执行：</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ php app/cli.php

这样程序会直接执行默认的任务及默认动作.
</pre></div>
</div>
<div class="section" id="id1">
<h3>从命令行参数列表中获取选项<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nv">$shortopts</span>  <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
<span class="nv">$shortopts</span> <span class="o">.=</span> <span class="s2">&quot;n:&quot;</span><span class="p">;</span>  <span class="c1">// -n=&quot;Phalcon&quot;</span>
<span class="nv">$shortopts</span> <span class="o">.=</span> <span class="s2">&quot;d::&quot;</span><span class="p">;</span> <span class="c1">// -d</span>
<span class="nv">$shortopts</span> <span class="o">.=</span> <span class="s2">&quot;D&quot;</span><span class="p">;</span>   <span class="c1">// -D</span>

<span class="nv">$options</span> <span class="o">=</span> <span class="nb">getopt</span><span class="p">(</span>
    <span class="nv">$shortopts</span><span class="p">,</span>
    <span class="k">array</span><span class="p">(</span>
        <span class="s1">&#39;namespace:&#39;</span><span class="p">,</span> <span class="c1">// 必选项 --namespace=Phalcon</span>
        <span class="s1">&#39;task::&#39;</span><span class="p">,</span>     <span class="c1">// 可选项 --task=main</span>
        <span class="s1">&#39;dev::&#39;</span><span class="p">,</span>      <span class="c1">// 可选项 --dev=true</span>
        <span class="s1">&#39;debug&#39;</span>       <span class="c1">// 无值   --debug</span>
        <span class="p">)</span>
<span class="p">);</span>

<span class="nv">$opts</span> <span class="o">=</span> <span class="nb">getopt</span><span class="p">(</span><span class="k">NULL</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;namespace:&#39;</span><span class="p">,</span> <span class="s1">&#39;dev::&#39;</span><span class="p">,</span><span class="s1">&#39;action::&#39;</span><span class="p">));</span>

<span class="c1">// 创建console应用</span>
<span class="nv">$console</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Cli\Console</span><span class="p">();</span>
<span class="nv">$console</span><span class="o">-&gt;</span><span class="na">setDI</span><span class="p">(</span><span class="nv">$di</span><span class="p">);</span>

<span class="c1">// 处理console应用参数</span>
<span class="nv">$arguments</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;namespace&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Phalcon\Arr</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="nv">$opts</span><span class="p">,</span> <span class="s1">&#39;namespace&#39;</span><span class="p">),</span>
    <span class="s1">&#39;task&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Phalcon\Arr</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="nv">$opts</span><span class="p">,</span> <span class="s1">&#39;task&#39;</span><span class="p">),</span>
    <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Phalcon\Arr</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="nv">$opts</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="nv">$console</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">(</span><span class="nv">$arguments</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">\Phalcon\Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="cli-options">
<h2>使用命令行选项类（Cli Options）<a class="headerlink" href="#cli-options" title="永久链接至标题">¶</a></h2>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nv">$opts</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Cli\Options</span><span class="p">(</span><span class="s1">&#39;Phalcon Task CLI&#39;</span><span class="p">);</span>
<span class="nv">$opts</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">([</span>
    <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Phalcon\Cli\Options</span><span class="o">::</span><span class="na">TYPE_STRING</span><span class="p">,</span>
    <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;namespace&#39;</span><span class="p">,</span>
    <span class="s1">&#39;shortName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;n&#39;</span><span class="p">,</span>
    <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
    <span class="s1">&#39;defaultValue&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;Phalcon&#39;</span>
<span class="p">]);</span>
<span class="nv">$opts</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">([</span>
    <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Phalcon\Cli\Options</span><span class="o">::</span><span class="na">TYPE_STRING</span><span class="p">,</span>
    <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;task&#39;</span><span class="p">,</span>
    <span class="s1">&#39;shortName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;t&#39;</span><span class="p">,</span>
    <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
    <span class="s1">&#39;defaultValue&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;main&#39;</span>
<span class="p">]);</span>
<span class="nv">$opts</span><span class="o">-&gt;</span><span class="na">add</span><span class="p">([</span>
    <span class="s1">&#39;type&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Phalcon\Cli\Options</span><span class="o">::</span><span class="na">TYPE_STRING</span><span class="p">,</span>
    <span class="s1">&#39;name&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;action&#39;</span><span class="p">,</span>
    <span class="s1">&#39;shortName&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;a&#39;</span><span class="p">,</span>
    <span class="s1">&#39;required&#39;</span> <span class="o">=&gt;</span> <span class="k">true</span><span class="p">,</span>
    <span class="s1">&#39;defaultValue&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;main&#39;</span>
<span class="p">]);</span>
<span class="nv">$vals</span> <span class="o">=</span> <span class="nv">$opts</span><span class="o">-&gt;</span><span class="na">parse</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$vals</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>

<span class="c1">// 创建console应用</span>
<span class="nv">$console</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">\Phalcon\Cli\Console</span><span class="p">();</span>

<span class="c1">// 处理console应用参数</span>
<span class="nv">$arguments</span> <span class="o">=</span> <span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;namespace&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Phalcon\Arr</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="nv">$vals</span><span class="p">,</span> <span class="s1">&#39;namespace&#39;</span><span class="p">),</span>
    <span class="s1">&#39;task&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Phalcon\Arr</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="nv">$vals</span><span class="p">,</span> <span class="s1">&#39;task&#39;</span><span class="p">),</span>
    <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="nx">\Phalcon\Arr</span><span class="o">::</span><span class="na">get</span><span class="p">(</span><span class="nv">$vals</span><span class="p">,</span> <span class="s1">&#39;action&#39;</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="nv">$console</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">(</span><span class="nv">$arguments</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">\Phalcon\Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="tasks">
<h2>任务（Tasks）<a class="headerlink" href="#tasks" title="永久链接至标题">¶</a></h2>
<p>这里的任务同于web应用中的控制器。 任一 CLI 应用程序都至少包含一个mainTask 及一个 mainAction， 每个任务至少有一个mainAction, 这样在使用者未明确的 指定action时 此mainAction就会执行。</p>
<p>下面即是一个mainTask的例子（ app/tasks/MainTask.php ）：</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">MainTask</span> <span class="k">extends</span> <span class="nx">\Phalcon\Cli\Task</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">mainAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">This is the default task and the default action </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="processing-action-parameters">
<h2>处理动作参数（Processing action parameters）<a class="headerlink" href="#processing-action-parameters" title="永久链接至标题">¶</a></h2>
<p>CLI应用中， 开发者也可以在action中处理传递过来的参数， 下面的例子中已经对传递过来的参数进行了处理。</p>
<p>如果你使用下面的参数和动作运行应用程序:</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">MainTask</span> <span class="k">extends</span> <span class="nx">\Phalcon\Cli\Task</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">mainAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">This is the default task and the default action </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="sd">/**</span>
<span class="sd">     * @param array $params</span>
<span class="sd">     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">testAction</span><span class="p">(</span><span class="k">array</span> <span class="nv">$params</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;hello %s&#39;</span><span class="p">,</span> <span class="nv">$params</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">.</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
        <span class="k">echo</span> <span class="nb">sprintf</span><span class="p">(</span><span class="s1">&#39;best regards, %s&#39;</span><span class="p">,</span> <span class="nv">$params</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">.</span> <span class="nx">PHP_EOL</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>我们可以使用下面的命令行及参数执行程序：</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ php app/cli.php main <span class="nb">test</span> world universe

hello world
best regards, universe
</pre></div>
</div>
</div>
<div class="section" id="running-tasks-in-a-chain">
<h2>链中运行任务（Running tasks in a chain）<a class="headerlink" href="#running-tasks-in-a-chain" title="永久链接至标题">¶</a></h2>
<p>CLI应用中可以在一个action中执行另一action. 要实现这个需要在 DI 中设置console.</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="nv">$di</span><span class="o">-&gt;</span><span class="na">setShared</span><span class="p">(</span><span class="s1">&#39;console&#39;</span><span class="p">,</span> <span class="nv">$console</span><span class="p">);</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="c1">// Handle incoming arguments</span>
    <span class="nv">$console</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">(</span><span class="nv">$arguments</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">\Phalcon\Exception</span> <span class="nv">$e</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">echo</span> <span class="nv">$e</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">();</span>
    <span class="k">exit</span><span class="p">(</span><span class="mi">255</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>然后开发者即可在一个action中使用用其它的action了. 下面即是例子：</p>
<div class="highlight-php"><div class="highlight"><pre><span></span><span class="cp">&lt;?php</span>

<span class="k">class</span> <span class="nc">MainTask</span> <span class="k">extends</span> <span class="nx">\Phalcon\Cli\Task</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">mainAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">This is the default task and the default action </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">console</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">(</span>
            <span class="k">array</span><span class="p">(</span>
                <span class="s1">&#39;task&#39;</span>   <span class="o">=&gt;</span> <span class="s1">&#39;main&#39;</span><span class="p">,</span>
                <span class="s1">&#39;action&#39;</span> <span class="o">=&gt;</span> <span class="s1">&#39;test&#39;</span>
            <span class="p">)</span>
        <span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">testAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">echo</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">I will get printed too!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>当然， 通过扩展 <a class="reference internal" href="../api/Phalcon_Cli_Task.html"><span class="doc">Phalcon\Cli\Task</span></a> 来实现如上操作会是一个更好主意。</p>
</div>
<div class="section" id="mvc-running-mvc-application">
<h2>运行 MVC 应用（Running MVC Application）<a class="headerlink" href="#mvc-running-mvc-application" title="永久链接至标题">¶</a></h2>
<p>使用MVC架构来开发的程序，在命令行下运行命令如下：</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ php app/index.php --url<span class="o">=</span><span class="s2">&quot;/auth/login&quot;</span>
</pre></div>
</div>
</div>
</div>


			</div>
		  </div>
		</div>
	</div>
  </div>
</div>
    <div class="related">
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="总目录"
             >索引</a></li>
        <li class="right" >
          <a href="cli-color.html" title="命令行设置文字颜色（Command Line Text Color）"
             >下一页</a> |</li>
        <li class="right" >
          <a href="annotations.html" title="注解解析器（Annotations Parser）"
             >上一页</a> |</li> 
      </ul>
    </div>

<footer class="footer">
	<div class="container">
      <div class="row">
          <div class="col-xs-6 col-sm-3">
              <h4>Download</h4>
              <ul>
                  <li><a href="https://github.com/dreamsxin/cphalcon7/releases">安裝 Phalcon7</a></li>
              </ul>
          </div>
          <div class="col-xs-6 col-sm-3">
              <h4>Community</h4>
              <ul>
                  <li><a href="https://github.com/dreamsxin/cphalcon7">GitHub</a></li>
                  <li><a href="https://github.com/dreamsxin/cphalcon7/issues">Issue Tracker</a></li>
              </ul>
          </div>
          <div class="col-xs-6 col-sm-2">
              <h4>About</h4>
              <ul>
                  <li><a href="https://github.com/dreamsxin/cphalcon/wiki/%E6%8D%90%E8%B5%A0%EF%BC%88Donation%EF%BC%89">Donate</a></li>
              </ul>
          </div>
          <div id="license-spaccer" class="visible-xs"></div>
          <div id="license-wrapper" class="col-xs-12 col-sm-4">
              <p class="license">

                  Phalcon7 Framework is released under the <a href="https://github.com/dreamsxin/cphalcon7/blob/master/docs/LICENSE.md">new BSD license</a>.<br>
                  Except where otherwise noted, content on this site is licensed under the
                  <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 License.</a>
              </p>
              <div class="design">
                  <span>Designed by:</span>

                  <a href="http://www.fog-city.net/" class="fogcity" target="_blank" title="Fog City Software"><span>Fog City Software</span></a>
              </div>
          </div>
      </div>
	</div>
</footer>
</body>
</html>