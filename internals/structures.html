<!DOCTYPE html>

<html lang="en">
<head>
    
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>常见的结构（Common Structures） &mdash; Phalcon7 1.2.1 文档</title>
    <meta name="keywords" content="php, phalcon, phalcon7, phalcon php, php framework, faster php framework">
    <link rel="stylesheet" type="text/css" href="../static/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../static/phalcon.css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1.2.1',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>

    <script src="../static/jquery.min.js"></script>
    <link rel="shortcut icon" href="../static/img/favicon.ico"/>
    <link rel="top" title="Phalcon7 1.2.1 文档" href="../index.html" /> 
</head>
<body>

<header class="page-header">
<nav class="navbar" role="navigation">
	<div class="container">
		<div class="navbar-header">
			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-menu-container">
				<span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span>
			</button>
			<a class="navbar-brand phalcon-logo" href="/"><span itemprop="name" class="sr-only">Phalcon PHP</span></a>
		</div>

		<div class="collapse navbar-collapse navbar-right" id="main-menu-container">
			<ul class="nav navbar-nav main-menu">
			  <li class="first"><a href="https://github.com/dreamsxin/cphalcon7" class="header-nav-link">GitHub</a></li>
			  <li class="first"><a href="https://github.com/dreamsxin/cphalcon7/releases" class="header-nav-link">Download</a></li>
			  <li class="first"><a href="/api/" class="header-nav-link">API</a></li>
			  <li class="first"><a href="/internals/" class="header-nav-link">内核开发手册</a></li>
			</ul>
		</div>
	</div>
</nav>
</header>

<div class="heading">
    <div class="container">
        <div class="row">
            <h2>Documentation</h2>
        </div>
    </div>
</div>


<div class="container-fluid">
    <div class="related">
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="总目录"
             accesskey="I">索引</a></li>
        <li><a href="http://myleftstudio.com">Home</a> &raquo;</li>
        <li><a href="../index.html">Phalcon7 1.2.1 文档</a> &raquo;</li> 
      </ul>
    </div>  
</div>

<div class="container-fluid">
	<div class="col-md-3 primary-box">
		<div class="panel panel-default">
			<div class="panel-heading"><a href="../index.html">內容目录</a></div>
			<div class="panel-body"><ul>
<li><a class="reference internal" href="#">常见的结构（Common Structures）</a><ul>
<li><a class="reference internal" href="#zvals">变量（Zvals）</a><ul>
<li><a class="reference internal" href="#id1">标志位</a></li>
</ul>
</li>
<li><a class="reference internal" href="#hashtable">哈希表（HashTable）</a><ul>
<li><a class="reference internal" href="#id2">哈希碰撞</a></li>
</ul>
</li>
<li><a class="reference internal" href="#zend-class-entries">类的原型（Zend Class Entries）</a><ul>
<li><a class="reference internal" href="#handlers">类的标准操作集合（handlers）</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
		</div>
	</div>
  <div class="col-md-9 second-box" valign="top">
	<div class="document">
		<div class="documentwrapper">
		  <div class="bodywrapper">
			<div class="body" >
			  
  <div class="section" id="common-structures">
<h1>常见的结构（Common Structures）<a class="headerlink" href="#common-structures" title="永久链接至标题">¶</a></h1>
<p>首先让我们来了解一些底层的常用的结构。</p>
<div class="section" id="zvals">
<h2>变量（Zvals）<a class="headerlink" href="#zvals" title="永久链接至标题">¶</a></h2>
<p>框架中最常用的变量是 zval。一个PHP应用程序中的每个值是一个变量。zval 是一个多态性结构，即一个 zval 变量可以是任何值（bool、string、long、double、array等）。
浏览 Phalcon7 内部的一些代码，你会看到，大多数变量的声明 zval。PHP具有标量数据类型和非标量数据类型（array 和 object）。</p>
<p>PHP7中的zval的类型做了比较大的调整, 总体来说有如下17种类型:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="cm">/* regular data types */</span>
<span class="cp">#define IS_UNDEF                    0</span>
<span class="cp">#define IS_NULL                     1</span>
<span class="cp">#define IS_FALSE                    2</span>
<span class="cp">#define IS_TRUE                     3</span>
<span class="cp">#define IS_LONG                     4</span>
<span class="cp">#define IS_DOUBLE                   5</span>
<span class="cp">#define IS_STRING                   6</span>
<span class="cp">#define IS_ARRAY                    7</span>
<span class="cp">#define IS_OBJECT                   8</span>
<span class="cp">#define IS_RESOURCE                 9</span>
<span class="cp">#define IS_REFERENCE                10</span>

<span class="cm">/* constant expressions */</span>
<span class="cp">#define IS_CONSTANT                 11</span>
<span class="cp">#define IS_CONSTANT_AST             12</span>

<span class="cm">/* fake types */</span>
<span class="cp">#define _IS_BOOL                    13</span>
<span class="cp">#define IS_CALLABLE                 14</span>

<span class="cm">/* internal types */</span>
<span class="cp">#define IS_INDIRECT                 15 </span><span class="c1">//间接变量，跟 compiled variables(CV) table 有关系</span>
<span class="cp">#define IS_PTR                      17</span>
</pre></div>
</div>
<div class="section" id="id1">
<h3>标志位<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h3>
<p>作用于zval的有：</p>
<div class="highlight-c"><div class="highlight"><pre><span class="cp">#define IS_TYPE_CONSTANT            </span><span class="c1">//是常量类型</span>
<span class="cp">#define IS_TYPE_IMMUTABLE           </span><span class="c1">//不可变的类型， 比如存在共享内存的数组</span>
<span class="cp">#define IS_TYPE_REFCOUNTED          </span><span class="c1">//需要引用计数的类型</span>
<span class="cp">#define IS_TYPE_COLLECTABLE         </span><span class="c1">//可能包含循环引用的类型(IS_ARRAY, IS_OBJECT)</span>
<span class="cp">#define IS_TYPE_COPYABLE            </span><span class="c1">//可被复制的类型， 还记得我之前讲的对象和资源的例外么？ 对象和资源就不是</span>
<span class="cp">#define IS_TYPE_SYMBOLTABLE         </span><span class="c1">//zval保存的是全局符号表， 这个在我之前做了一个调整以后没用了， 但还保留着兼容，下个版本会去掉</span>
</pre></div>
</div>
<p>作用于字符串的有:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="cp">#define IS_STR_PERSISTENT               </span><span class="c1">//是malloc分配内存的字符串</span>
<span class="cp">#define IS_STR_INTERNED             </span><span class="c1">//INTERNED STRING</span>
<span class="cp">#define IS_STR_PERMANENT            </span><span class="c1">//不可变的字符串， 用作哨兵作用</span>
<span class="cp">#define IS_STR_CONSTANT             </span><span class="c1">//代表常量的字符串</span>
<span class="cp">#define IS_STR_CONSTANT_UNQUALIFIED </span><span class="c1">//带有可能命名空间的常量字符串</span>
</pre></div>
</div>
<p>作用于数组的有:</p>
<div class="highlight-c"><div class="highlight"><pre><span class="cp">#define IS_ARRAY_IMMUTABLE  </span><span class="c1">//同IS_TYPE_IMMUTABLE</span>
</pre></div>
</div>
<p>作用于对象的有：</p>
<div class="highlight-c"><div class="highlight"><pre><span class="cp">#define IS_OBJ_APPLY_COUNT          </span><span class="c1">//递归保护</span>
<span class="cp">#define IS_OBJ_DESTRUCTOR_CALLED    </span><span class="c1">//析构函数已经调用</span>
<span class="cp">#define IS_OBJ_FREE_CALLED          </span><span class="c1">//清理函数已经调用</span>
<span class="cp">#define IS_OBJ_USE_GUARDS           </span><span class="c1">//魔术方法递归保护</span>
<span class="cp">#define IS_OBJ_HAS_GUARDS           </span><span class="c1">//是否有魔术方法递归保护标志</span>
</pre></div>
</div>
<p>下面演示如何给 zval 赋予不同类型的值：</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">zval</span> <span class="n">name</span><span class="p">,</span> <span class="n">numner</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">nothing</span><span class="p">,</span> <span class="n">is_alive</span><span class="p">,</span> <span class="n">imagick</span><span class="p">;</span>

<span class="n">ZVAL_STRING</span><span class="p">(</span><span class="o">&amp;</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;Sonny&quot;</span><span class="p">);</span>
<span class="n">ZVAL_LONG</span><span class="p">(</span><span class="o">&amp;</span><span class="n">number</span><span class="p">,</span> <span class="mi">12000</span><span class="p">);</span>
<span class="n">ZVAL_DOUBLE</span><span class="p">(</span><span class="o">&amp;</span><span class="n">price</span><span class="p">,</span> <span class="mf">15.50</span><span class="p">);</span>
<span class="n">ZVAL_NULL</span><span class="p">(</span><span class="o">&amp;</span><span class="n">nothing</span><span class="p">);</span>
<span class="n">ZVAL_BOOL</span><span class="p">(</span><span class="o">&amp;</span><span class="n">is_alive</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>

<span class="n">object_init_ex</span><span class="p">(</span><span class="o">&amp;</span><span class="n">imagick</span><span class="p">,</span> <span class="n">imagick_ce</span><span class="p">);</span>
</pre></div>
</div>
<p>通常情况下，我们不会直接去改变 zval 内部变量，而是使用 Zend API 提供的方法进行管理。</p>
<p>让我看下如何获取 zval 变量的值：</p>
<div class="highlight-c"><div class="highlight"><pre><span class="kt">char</span> <span class="o">*</span><span class="n">str</span> <span class="o">=</span> <span class="n">Z_STRVAL</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<span class="kt">long</span> <span class="n">number</span> <span class="o">=</span> <span class="n">Z_LVAL</span><span class="p">(</span><span class="n">numner</span><span class="p">);</span>
<span class="kt">int</span> <span class="n">bool_value</span> <span class="o">=</span> <span class="n">Z_BVA</span><span class="p">(</span><span class="n">is_alive</span><span class="p">);</span>
</pre></div>
</div>
<p>如果您想知道 zval 值的类型：</p>
<div class="highlight-c"><div class="highlight"><pre><span class="kt">int</span> <span class="n">type</span> <span class="o">=</span> <span class="n">Z_TYPE</span><span class="p">(</span><span class="n">some_variable</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">type</span> <span class="o">==</span> <span class="n">IS_STRING</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Is string!</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="hashtable">
<h2>哈希表（HashTable）<a class="headerlink" href="#hashtable" title="永久链接至标题">¶</a></h2>
<p>哈希表是 PHP 内部非常重要的数据结构，除了最常见的数组，内核也随处用到，比如 function、class 的索引、符号表等等都用到了哈希表。</p>
<div class="highlight-c"><div class="highlight"><pre><span class="k">typedef</span> <span class="k">struct</span> <span class="n">_Bucket</span> <span class="p">{</span>
    <span class="n">zval</span>              <span class="n">val</span><span class="p">;</span>
    <span class="n">zend_ulong</span>        <span class="n">h</span><span class="p">;</span>                <span class="cm">/* hash value (or numeric index)   */</span>
    <span class="n">zend_string</span>      <span class="o">*</span><span class="n">key</span><span class="p">;</span>              <span class="cm">/* string key or NULL for numerics */</span>
<span class="p">}</span> <span class="n">Bucket</span><span class="p">;</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="n">_zend_array</span> <span class="n">HashTable</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">_zend_array</span> <span class="p">{</span>
    <span class="n">zend_refcounted_h</span> <span class="n">gc</span><span class="p">;</span>
    <span class="k">union</span> <span class="p">{</span>
        <span class="k">struct</span> <span class="p">{</span>
            <span class="n">ZEND_ENDIAN_LOHI_4</span><span class="p">(</span>
                    <span class="n">zend_uchar</span>    <span class="n">flags</span><span class="p">,</span>
                    <span class="n">zend_uchar</span>    <span class="n">nApplyCount</span><span class="p">,</span>
                    <span class="n">zend_uchar</span>    <span class="n">nIteratorsCount</span><span class="p">,</span>
                    <span class="n">zend_uchar</span>    <span class="n">reserve</span><span class="p">)</span>
        <span class="p">}</span> <span class="n">v</span><span class="p">;</span>
        <span class="kt">uint32_t</span> <span class="n">flags</span><span class="p">;</span>
    <span class="p">}</span> <span class="n">u</span><span class="p">;</span>
    <span class="kt">uint32_t</span>          <span class="n">nTableMask</span><span class="p">;</span>               <span class="c1">// 哈希值计算掩码，等于nTableSize的负值(nTableMask = ~nTableSize + 1)</span>
    <span class="n">Bucket</span>           <span class="o">*</span><span class="n">arData</span><span class="p">;</span>                   <span class="c1">// 存储元素数组，指向第一个Bucket</span>
    <span class="kt">uint32_t</span>          <span class="n">nNumUsed</span><span class="p">;</span>                 <span class="c1">// 已用Bucket数</span>
    <span class="kt">uint32_t</span>          <span class="n">nNumOfElements</span><span class="p">;</span>   <span class="c1">// 哈希表已有元素数</span>
    <span class="kt">uint32_t</span>          <span class="n">nTableSize</span><span class="p">;</span>               <span class="c1">// 哈希表总大小，为2的n次方</span>
    <span class="kt">uint32_t</span>          <span class="n">nInternalPointer</span><span class="p">;</span>
    <span class="n">zend_long</span>         <span class="n">nNextFreeElement</span><span class="p">;</span> <span class="c1">// 下一个可用的数值索引,如:arr[] = 1;arr[&quot;a&quot;] = 2;arr[] = 3;  则nNextFreeElement = 2;</span>
    <span class="n">dtor_func_t</span>       <span class="n">pDestructor</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<div class="section" id="id2">
<h3>哈希碰撞<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h3>
<p>哈希碰撞是指不同的key可能计算得到相同的哈希值(数值索引的哈希值直接就是数值本身)，但是这些值又需要插入同一个哈希表。一般解决方法是将Bucket串成链表，查找时遍历链表比较key。</p>
<p>PHP的实现也是类似，只是指向冲突元素的指针并没有直接存在Bucket中，而是存在嵌入的zval中，zval的结构：</p>
<div class="highlight-c"><div class="highlight"><pre><span class="k">struct</span> <span class="n">_zval_struct</span> <span class="p">{</span>
    <span class="n">zend_value</span>        <span class="n">value</span><span class="p">;</span>            <span class="cm">/* value */</span>
    <span class="k">union</span> <span class="p">{</span>
        <span class="k">struct</span> <span class="p">{</span>
            <span class="n">ZEND_ENDIAN_LOHI_4</span><span class="p">(</span>
                    <span class="n">zend_uchar</span>    <span class="n">type</span><span class="p">,</span>         <span class="cm">/* active type */</span>
                    <span class="n">zend_uchar</span>    <span class="n">type_flags</span><span class="p">,</span>
                    <span class="n">zend_uchar</span>    <span class="n">const_flags</span><span class="p">,</span>
                    <span class="n">zend_uchar</span>    <span class="n">reserved</span><span class="p">)</span>     <span class="cm">/* call info for EX(This) */</span>
        <span class="p">}</span> <span class="n">v</span><span class="p">;</span>
        <span class="kt">uint32_t</span> <span class="n">type_info</span><span class="p">;</span>
    <span class="p">}</span> <span class="n">u1</span><span class="p">;</span>
    <span class="k">union</span> <span class="p">{</span>
        <span class="kt">uint32_t</span>     <span class="n">var_flags</span><span class="p">;</span>
        <span class="kt">uint32_t</span>     <span class="n">next</span><span class="p">;</span>                 <span class="cm">/* hash collision chain */</span>
        <span class="kt">uint32_t</span>     <span class="n">cache_slot</span><span class="p">;</span>           <span class="cm">/* literal cache slot */</span>
        <span class="kt">uint32_t</span>     <span class="n">lineno</span><span class="p">;</span>               <span class="cm">/* line number (for ast nodes) */</span>
        <span class="kt">uint32_t</span>     <span class="n">num_args</span><span class="p">;</span>             <span class="cm">/* arguments number for EX(This) */</span>
        <span class="kt">uint32_t</span>     <span class="n">fe_pos</span><span class="p">;</span>               <span class="cm">/* foreach position */</span>
        <span class="kt">uint32_t</span>     <span class="n">fe_iter_idx</span><span class="p">;</span>          <span class="cm">/* foreach iterator index */</span>
    <span class="p">}</span> <span class="n">u2</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
<p>HashTable 中有两个非常相近的值：nNumUsed、nNumOfElements，nNumOfElements表示哈希表已有元素数，那这个值不跟nNumUsed一样吗？为什么要定义两个呢？实际上它们有不同的含义，当将一个元素从哈希表删除时并不会将对应的Bucket移除，而是将Bucket存储的zval标示为IS_UNDEF，只有扩容时发现nNumOfElements与nNumUsed相差达到一定数量(这个数量是:ht-&gt;nNumUsed - ht-&gt;nNumOfElements &gt; (ht-&gt;nNumOfElements &gt;&gt; 5))时才会将已删除的元素全部移除，重新构建哈希表。所以nNumUsed&gt;=nNumOfElements。</p>
<p>HashTable 中另外一个非常重要的值 arData，这个值指向存储元素数组的第一个Bucket，插入元素时按顺序依次插入数组，比如第一个元素在arData[0]、第二个在arData[1]…arData[nNumUsed]。PHP数组的有序性正是通过arData保证的。</p>
<p>zval.u2.next 存的就是冲突元素在Bucket数组中的位置，所以查找过程类似：</p>
<div class="highlight-c"><div class="highlight"><pre><span class="n">zend_ulong</span> <span class="n">h</span> <span class="o">=</span> <span class="n">zend_string_hash_val</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
<span class="kt">uint32_t</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">ht</span><span class="o">-&gt;</span><span class="n">arHash</span><span class="p">[</span><span class="n">h</span> <span class="o">&amp;</span> <span class="n">ht</span><span class="o">-&gt;</span><span class="n">nTableMask</span><span class="p">];</span>
<span class="k">while</span> <span class="p">(</span><span class="n">idx</span> <span class="o">!=</span> <span class="n">INVALID_IDX</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Bucket</span> <span class="o">*</span><span class="n">b</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ht</span><span class="o">-&gt;</span><span class="n">arData</span><span class="p">[</span><span class="n">idx</span><span class="p">];</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">h</span> <span class="o">==</span> <span class="n">h</span> <span class="o">&amp;&amp;</span> <span class="n">zend_string_equals</span><span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">key</span><span class="p">,</span> <span class="n">key</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">b</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="n">Z_NEXT</span><span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">val</span><span class="p">);</span> <span class="c1">// b-&gt;val.u2.next</span>
<span class="p">}</span>
<span class="k">return</span> <span class="nb">NULL</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="zend-class-entries">
<h2>类的原型（Zend Class Entries）<a class="headerlink" href="#zend-class-entries" title="永久链接至标题">¶</a></h2>
<p>该结构体帮助我们定义类，包括它的名字、方法、属性等等。</p>
<div class="highlight-c"><div class="highlight"><pre><span class="c1">//Get the class entry</span>
<span class="n">class_entry</span> <span class="o">=</span> <span class="n">Z_OBJCE_P</span><span class="p">(</span><span class="n">this_ptr</span><span class="p">);</span>

<span class="c1">//Print the class name</span>
<span class="n">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">class_entry</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">);</span>
</pre></div>
</div>
<div class="section" id="handlers">
<h3>类的标准操作集合（handlers）<a class="headerlink" href="#handlers" title="永久链接至标题">¶</a></h3>
<div class="highlight-c"><div class="highlight"><pre><span class="k">struct</span> <span class="n">_zend_object</span> <span class="p">{</span>
        <span class="n">zend_refcounted_h</span> <span class="n">gc</span><span class="p">;</span>
        <span class="kt">uint32_t</span>          <span class="n">handle</span><span class="p">;</span> <span class="c1">// TODO: may be removed ???</span>
        <span class="n">zend_class_entry</span> <span class="o">*</span><span class="n">ce</span><span class="p">;</span>
        <span class="k">const</span> <span class="n">zend_object_handlers</span> <span class="o">*</span><span class="n">handlers</span><span class="p">;</span>
        <span class="n">HashTable</span>        <span class="o">*</span><span class="n">properties</span><span class="p">;</span>
        <span class="n">zval</span>              <span class="n">properties_table</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
<span class="p">};</span>

<span class="cm">/* Used to call methods */</span>
<span class="cm">/* args on stack! */</span>
<span class="cm">/* Andi - EX(fbc) (function being called) needs to be initialized already in the INIT fcall opcode so that the parameters can be parsed the right way. We need to add another callback for this.</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span><span class="n">zend_object_call_method_t</span><span class="p">)(</span><span class="n">zend_string</span> <span class="o">*</span><span class="n">method</span><span class="p">,</span> <span class="n">zend_object</span> <span class="o">*</span><span class="n">object</span><span class="p">,</span> <span class="n">INTERNAL_FUNCTION_PARAMETERS</span><span class="p">);</span>
<span class="k">typedef</span> <span class="k">union</span> <span class="n">_zend_function</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">zend_object_get_method_t</span><span class="p">)(</span><span class="n">zend_object</span> <span class="o">**</span><span class="n">object</span><span class="p">,</span> <span class="n">zend_string</span> <span class="o">*</span><span class="n">method</span><span class="p">,</span> <span class="k">const</span> <span class="n">zval</span> <span class="o">*</span><span class="n">key</span><span class="p">);</span>
<span class="k">typedef</span> <span class="k">union</span> <span class="n">_zend_function</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">zend_object_get_constructor_t</span><span class="p">)(</span><span class="n">zend_object</span> <span class="o">*</span><span class="n">object</span><span class="p">);</span>

<span class="cm">/* Object maintenance/destruction */</span>
<span class="k">typedef</span> <span class="nf">void</span> <span class="p">(</span><span class="o">*</span><span class="n">zend_object_dtor_obj_t</span><span class="p">)(</span><span class="n">zend_object</span> <span class="o">*</span><span class="n">object</span><span class="p">);</span>
<span class="k">typedef</span> <span class="nf">void</span> <span class="p">(</span><span class="o">*</span><span class="n">zend_object_free_obj_t</span><span class="p">)(</span><span class="n">zend_object</span> <span class="o">*</span><span class="n">object</span><span class="p">);</span>
<span class="k">typedef</span> <span class="n">zend_object</span><span class="o">*</span> <span class="p">(</span><span class="o">*</span><span class="n">zend_object_clone_obj_t</span><span class="p">)(</span><span class="n">zval</span> <span class="o">*</span><span class="n">object</span><span class="p">);</span>

<span class="cm">/* Get class name for display in var_dump and other debugging functions.</span>
<span class="cm"> * Must be defined and must return a non-NULL value. */</span>
<span class="k">typedef</span> <span class="n">zend_string</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">zend_object_get_class_name_t</span><span class="p">)(</span><span class="k">const</span> <span class="n">zend_object</span> <span class="o">*</span><span class="n">object</span><span class="p">);</span>

<span class="k">typedef</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span><span class="n">zend_object_compare_t</span><span class="p">)(</span><span class="n">zval</span> <span class="o">*</span><span class="n">object1</span><span class="p">,</span> <span class="n">zval</span> <span class="o">*</span><span class="n">object2</span><span class="p">);</span>
<span class="k">typedef</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span><span class="n">zend_object_compare_zvals_t</span><span class="p">)(</span><span class="n">zval</span> <span class="o">*</span><span class="n">resul</span><span class="p">,</span> <span class="n">zval</span> <span class="o">*</span><span class="n">op1</span><span class="p">,</span> <span class="n">zval</span> <span class="o">*</span><span class="n">op2</span><span class="p">);</span>

<span class="cm">/* Cast an object to some other type</span>
<span class="cm"> */</span>
<span class="k">typedef</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span><span class="n">zend_object_cast_t</span><span class="p">)(</span><span class="n">zval</span> <span class="o">*</span><span class="n">readobj</span><span class="p">,</span> <span class="n">zval</span> <span class="o">*</span><span class="n">retval</span><span class="p">,</span> <span class="kt">int</span> <span class="n">type</span><span class="p">);</span>

<span class="cm">/* updates *count to hold the number of elements present and returns SUCCESS.</span>
<span class="cm"> * Returns FAILURE if the object does not have any sense of overloaded dimensions */</span>
<span class="k">typedef</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span><span class="n">zend_object_count_elements_t</span><span class="p">)(</span><span class="n">zval</span> <span class="o">*</span><span class="n">object</span><span class="p">,</span> <span class="n">zend_long</span> <span class="o">*</span><span class="n">count</span><span class="p">);</span>

<span class="k">typedef</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span><span class="n">zend_object_get_closure_t</span><span class="p">)(</span><span class="n">zval</span> <span class="o">*</span><span class="n">obj</span><span class="p">,</span> <span class="n">zend_class_entry</span> <span class="o">**</span><span class="n">ce_ptr</span><span class="p">,</span> <span class="k">union</span> <span class="n">_zend_function</span> <span class="o">**</span><span class="n">fptr_ptr</span><span class="p">,</span> <span class="n">zend_object</span> <span class="o">**</span><span class="n">obj_ptr</span><span class="p">);</span>

<span class="k">typedef</span> <span class="n">HashTable</span> <span class="o">*</span><span class="p">(</span><span class="o">*</span><span class="n">zend_object_get_gc_t</span><span class="p">)(</span><span class="n">zval</span> <span class="o">*</span><span class="n">object</span><span class="p">,</span> <span class="n">zval</span> <span class="o">**</span><span class="n">table</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">n</span><span class="p">);</span>

<span class="k">typedef</span> <span class="nf">int</span> <span class="p">(</span><span class="o">*</span><span class="n">zend_object_do_operation_t</span><span class="p">)(</span><span class="n">zend_uchar</span> <span class="n">opcode</span><span class="p">,</span> <span class="n">zval</span> <span class="o">*</span><span class="n">result</span><span class="p">,</span> <span class="n">zval</span> <span class="o">*</span><span class="n">op1</span><span class="p">,</span> <span class="n">zval</span> <span class="o">*</span><span class="n">op2</span><span class="p">);</span>

<span class="k">struct</span> <span class="n">_zend_object_handlers</span> <span class="p">{</span>
        <span class="cm">/* offset of real object header (usually zero) */</span>
        <span class="kt">int</span>                                                                             <span class="n">offset</span><span class="p">;</span>
        <span class="cm">/* general object functions */</span>
        <span class="n">zend_object_free_obj_t</span>                                  <span class="n">free_obj</span><span class="p">;</span>
        <span class="n">zend_object_dtor_obj_t</span>                                  <span class="n">dtor_obj</span><span class="p">;</span>
        <span class="n">zend_object_clone_obj_t</span>                                 <span class="n">clone_obj</span><span class="p">;</span>
        <span class="cm">/* individual object functions */</span>
        <span class="n">zend_object_read_property_t</span>                             <span class="n">read_property</span><span class="p">;</span>
        <span class="n">zend_object_write_property_t</span>                    <span class="n">write_property</span><span class="p">;</span>
        <span class="n">zend_object_read_dimension_t</span>                    <span class="n">read_dimension</span><span class="p">;</span>
        <span class="n">zend_object_write_dimension_t</span>                   <span class="n">write_dimension</span><span class="p">;</span>
        <span class="n">zend_object_get_property_ptr_ptr_t</span>              <span class="n">get_property_ptr_ptr</span><span class="p">;</span>
        <span class="n">zend_object_get_t</span>                                               <span class="n">get</span><span class="p">;</span>
        <span class="n">zend_object_set_t</span>                                               <span class="n">set</span><span class="p">;</span>
        <span class="n">zend_object_has_property_t</span>                              <span class="n">has_property</span><span class="p">;</span>
        <span class="n">zend_object_unset_property_t</span>                    <span class="n">unset_property</span><span class="p">;</span>
        <span class="n">zend_object_has_dimension_t</span>                             <span class="n">has_dimension</span><span class="p">;</span>
        <span class="n">zend_object_unset_dimension_t</span>                   <span class="n">unset_dimension</span><span class="p">;</span>
        <span class="n">zend_object_get_properties_t</span>                    <span class="n">get_properties</span><span class="p">;</span>
        <span class="n">zend_object_get_method_t</span>                                <span class="n">get_method</span><span class="p">;</span>
        <span class="n">zend_object_call_method_t</span>                               <span class="n">call_method</span><span class="p">;</span>
        <span class="n">zend_object_get_constructor_t</span>                   <span class="n">get_constructor</span><span class="p">;</span>
        <span class="n">zend_object_get_class_name_t</span>                    <span class="n">get_class_name</span><span class="p">;</span>
        <span class="n">zend_object_compare_t</span>                                   <span class="n">compare_objects</span><span class="p">;</span>
        <span class="n">zend_object_cast_t</span>                                              <span class="n">cast_object</span><span class="p">;</span>
        <span class="n">zend_object_count_elements_t</span>                    <span class="n">count_elements</span><span class="p">;</span>
        <span class="n">zend_object_get_debug_info_t</span>                    <span class="n">get_debug_info</span><span class="p">;</span>
        <span class="n">zend_object_get_closure_t</span>                               <span class="n">get_closure</span><span class="p">;</span>
        <span class="n">zend_object_get_gc_t</span>                                    <span class="n">get_gc</span><span class="p">;</span>
        <span class="n">zend_object_do_operation_t</span>                              <span class="n">do_operation</span><span class="p">;</span>
        <span class="n">zend_object_compare_zvals_t</span>                             <span class="n">compare</span><span class="p">;</span>
<span class="p">};</span>
</pre></div>
</div>
</div>
</div>
</div>


			</div>
		  </div>
		</div>
	</div>
  </div>
</div>
    <div class="related">
      <ul>
        <li class="right" >
          <a href="../genindex.html" title="总目录"
             >索引</a></li> 
      </ul>
    </div>

<footer class="footer">
	<div class="container">
      <div class="row">
          <div class="col-xs-6 col-sm-3">
              <h4>Download</h4>
              <ul>
                  <li><a href="https://github.com/dreamsxin/cphalcon7/releases">安裝 Phalcon7</a></li>
              </ul>
          </div>
          <div class="col-xs-6 col-sm-3">
              <h4>Community</h4>
              <ul>
                  <li><a href="https://github.com/dreamsxin/cphalcon7">GitHub</a></li>
                  <li><a href="https://github.com/dreamsxin/cphalcon7/issues">Issue Tracker</a></li>
              </ul>
          </div>
          <div class="col-xs-6 col-sm-2">
              <h4>About</h4>
              <ul>
                  <li><a href="https://github.com/dreamsxin/cphalcon/wiki/%E6%8D%90%E8%B5%A0%EF%BC%88Donation%EF%BC%89">Donate</a></li>
              </ul>
          </div>
          <div id="license-spaccer" class="visible-xs"></div>
          <div id="license-wrapper" class="col-xs-12 col-sm-4">
              <p class="license">

                  Phalcon7 Framework is released under the <a href="https://github.com/dreamsxin/cphalcon7/blob/master/docs/LICENSE.md">new BSD license</a>.<br>
                  Except where otherwise noted, content on this site is licensed under the
                  <a href="http://creativecommons.org/licenses/by/3.0/">Creative Commons Attribution 3.0 License.</a>
              </p>
              <div class="design">
                  <span>Designed by:</span>

                  <a href="http://www.fog-city.net/" class="fogcity" target="_blank" title="Fog City Software"><span>Fog City Software</span></a>
              </div>
          </div>
      </div>
	</div>
</footer>
</body>
</html>